{
  "roadmap_version": "1.0.0",
  "product_scope": {
    "focus": "smartcontract + project audited flow + fee/referral readiness",
    "modules_order": ["presale", "fairlaunch", "bonding_curve"],
    "current_state": {
      "admin_dashboard_ui": "DONE",
      "create_presale_ui": "DONE (built by agent sonnet)",
      "scan_and_audit_flow": "NOT_IMPLEMENTED",
      "project_audited_badge_logic": "NOT_IMPLEMENTED",
      "notes": [
        "Presale punya 2 opsi SC: external (dev bring own) vs launchpad template auto-deploy",
        "Fairlaunch & Bonding Curve: SC dibuat dari launchpad template/factory (no external SC in MVP)"
      ]
    }
  },
  "global_decisions": {
    "badge_names": {
      "primary": "PROJECT_AUDITED",
      "secondary_optional": "SECURITY_AUDITED"
    },
    "badge_truthfulness_rule": {
      "external_contract": "PROJECT_AUDITED only after scan PASS (or admin override PASS with audit log)",
      "launchpad_template": "PROJECT_AUDITED inherited from audited template version (or factory-verified if you choose relaxed mode)"
    },
    "strictness_mode_for_template_inheritance": {
      "mode": "STRICT",
      "meaning": "PROJECT_AUDITED (template) requires template_version has audit record; otherwise show 'Factory Verified' but not Project Audited"
    }
  },
  "tracks": [
    {
      "track_id": "presale",
      "title": "Presale Roadmap (EVM + Solana) + UI alignment + Admin",
      "milestones": [
        {
          "milestone_id": "P0",
          "title": "Foundations: DB + APIs + Admin permissions",
          "priority": "P0",
          "dependencies": [],
          "deliverables": [
            "DB tables for contract provenance, scan runs, audit proofs, and badge instances",
            "Edge Functions / API endpoints for: start scan, get scan status, attach audit proof, issue/revoke badge",
            "Admin RBAC actions for review/override with full audit logs"
          ],
          "acceptance_criteria": [
            "Backend can record a presale project's contract mode: EXTERNAL_CONTRACT or LAUNCHPAD_TEMPLATE",
            "Badge instance PROJECT_AUDITED can be created/revoked with metadata and audit logs",
            "Admin override requires reason + reviewer id and is logged"
          ],
          "work_items": [
            {
              "id": "P0-DB-1",
              "type": "backend",
              "title": "Create DB schema for scan/audit/badges",
              "details": {
                "tables": [
                  "project_contracts",
                  "contract_scan_runs",
                  "contract_audit_proofs",
                  "badge_definitions",
                  "badge_instances",
                  "admin_audit_logs"
                ],
                "key_fields": {
                  "project_contracts": [
                    "project_id",
                    "network",
                    "mode(EXTERNAL_CONTRACT|LAUNCHPAD_TEMPLATE)",
                    "contract_address_or_program_id",
                    "factory_address(optional)",
                    "template_version(optional)",
                    "implementation_hash_or_bytecode_hash(optional)"
                  ],
                  "contract_scan_runs": [
                    "scan_run_id",
                    "project_id",
                    "network",
                    "target_address",
                    "status(PENDING|RUNNING|PASS|FAIL|NEEDS_REVIEW)",
                    "risk_summary_json",
                    "created_at",
                    "finished_at"
                  ],
                  "contract_audit_proofs": [
                    "proof_id",
                    "project_id",
                    "auditor_name",
                    "report_url",
                    "report_hash",
                    "audit_date",
                    "scope_json",
                    "status(PENDING|VERIFIED|REJECTED)",
                    "verified_by_admin"
                  ],
                  "badge_instances": [
                    "badge_code",
                    "entity_type(project)",
                    "entity_id(project_id)",
                    "status(ACTIVE|EXPIRED|REVOKED)",
                    "issued_by(system|admin)",
                    "metadata_json"
                  ]
                }
              },
              "owners": ["backend", "db"]
            },
            {
              "id": "P0-API-1",
              "type": "backend",
              "title": "Implement API/Edge Functions for scan + badge issuance",
              "endpoints": [
                "POST /projects/:id/contract/scan/start",
                "GET  /projects/:id/contract/scan/status",
                "POST /projects/:id/audit-proof/submit",
                "POST /admin/projects/:id/scan/override",
                "POST /admin/projects/:id/badges/issue",
                "POST /admin/projects/:id/badges/revoke"
              ],
              "security": [
                "Server-side checks only (no trusting FE)",
                "RBAC enforced",
                "Rate limit scan start",
                "Idempotency key for scan start"
              ],
              "owners": ["backend"]
            },
            {
              "id": "P0-ADMIN-1",
              "type": "admin",
              "title": "Admin review queue for scan & audit proof",
              "ui_changes": [
                "Scan runs list + detail view",
                "Audit proof verification view",
                "Override PASS/FAIL with reason",
                "Issue/Revoke badges with metadata preview"
              ],
              "owners": ["admin-ui", "backend"]
            }
          ]
        },
        {
          "milestone_id": "P1",
          "title": "Presale EVM: External SC scan gate + UI flow integration",
          "priority": "P0",
          "dependencies": ["P0"],
          "deliverables": [
            "Create Presale UI updated to support 2 modes: Use My Contract vs Launchpad Contract",
            "External contract scan step + progress + result handling",
            "Hard gate on create presale (server denies if requirements unmet)",
            "PROJECT_AUDITED issuance for external PASS"
          ],
          "acceptance_criteria": [
            "If user selects external SC and scan != PASS, presale creation is blocked server-side",
            "UI shows scan statuses and clear next actions (re-run scan / submit for review)",
            "On PASS, PROJECT_AUDITED badge is active with audit_source=EXTERNAL_CONTRACT metadata",
            "All transitions are recorded: scan started, scan finished, badge issued"
          ],
          "work_items": [
            {
              "id": "P1-UI-1",
              "type": "frontend",
              "title": "Update Create Presale wizard to include Contract Mode selection",
              "ui_spec": {
                "step_order": [
                  "Select Network (EVM / Solana)",
                  "Select Contract Mode (External / Launchpad Template)",
                  "External Mode: Enter Contract Address -> Run Scan -> Scan Result",
                  "Launchpad Mode: Review Template Version -> Continue",
                  "Presale Params -> Review -> Submit"
                ],
                "ui_states": [
                  "SCAN_IDLE",
                  "SCAN_RUNNING",
                  "SCAN_PASS",
                  "SCAN_FAIL",
                  "SCAN_NEEDS_REVIEW"
                ]
              },
              "owners": ["frontend"]
            },
            {
              "id": "P1-UI-2",
              "type": "frontend",
              "title": "Integrate scan APIs in UI (start/status/polling)",
              "notes": [
                "Polling interval: 2-3s while RUNNING",
                "Stop polling on PASS/FAIL/NEEDS_REVIEW",
                "Show risk summary in FAIL/NEEDS_REVIEW"
              ],
              "owners": ["frontend", "backend"]
            },
            {
              "id": "P1-BE-1",
              "type": "backend",
              "title": "Server-side gate on presale create (EVM external)",
              "rules": [
                "external_contract requires scan_status == PASS OR admin_override_pass == true",
                "DEV_KYC_VERIFIED required (if enabled in your policy)",
                "If audit strict tier enabled: SECURITY_AUDITED required for certain hardcaps"
              ],
              "owners": ["backend"]
            },
            {
              "id": "P1-SCAN-1",
              "type": "backend",
              "title": "Implement EVM scan runner (minimal viable checks)",
              "checks": [
                "Contract exists (code size > 0)",
                "Interface compatibility for presale (required methods/events)",
                "Owner/admin privileges detection (ownable, roles)",
                "Proxy detection (optional: reject or require review)",
                "Dangerous ops heuristics (mint, blacklist, withdraw-all patterns)"
              ],
              "outputs": ["risk_score", "risk_flags[]", "human_readable_summary"],
              "owners": ["backend", "security"]
            }
          ],
          "agent_instructions_for_sonnet": {
            "task": "Update Create Presale UI to add External Contract scan flow",
            "screens": [
              "Create Presale - Contract Mode",
              "External Contract - Scan Step",
              "Scan Result - PASS/FAIL/NEEDS_REVIEW",
              "Review & Submit - shows Project Audited status"
            ],
            "api_contract": [
              "POST /projects/:id/contract/scan/start",
              "GET /projects/:id/contract/scan/status"
            ],
            "ui_acceptance": [
              "No presale submit button when scan not PASS for external mode",
              "Clear banners explaining why blocked and how to resolve"
            ]
          }
        },
        {
          "milestone_id": "P2",
          "title": "Presale EVM: Launchpad template deploy + auto Project Audited (STRICT inheritance)",
          "priority": "P0",
          "dependencies": ["P0"],
          "deliverables": [
            "Deploy presale contract via factory (Launchpad Template)",
            "Persist template_version + implementation hash on creation",
            "Auto-issue PROJECT_AUDITED only if template_version has audit record (STRICT mode)"
          ],
          "acceptance_criteria": [
            "When template_version lacks audit record: UI shows 'Factory Verified' but not Project Audited",
            "When template_version has audit record: PROJECT_AUDITED badge ACTIVE with audit_source=LAUNCHPAD_TEMPLATE metadata",
            "Factory event includes template_version (or backend computes implementation hash)"
          ],
          "work_items": [
            {
              "id": "P2-SC-1",
              "type": "smartcontract",
              "title": "PresaleFactory emits template version info",
              "events": [
                "PresaleCreated(projectId, presaleAddress, templateVersion, implementationHash)"
              ],
              "owners": ["smartcontract-evm"]
            },
            {
              "id": "P2-BE-1",
              "type": "backend",
              "title": "Template audit registry + enforcement (STRICT)",
              "details": {
                "table": "template_audits",
                "fields": [
                  "network",
                  "factory_address",
                  "template_version",
                  "implementation_hash",
                  "audit_report_ref",
                  "status(VALID|REVOKED)"
                ]
              },
              "owners": ["backend", "admin-ui"]
            },
            {
              "id": "P2-UI-1",
              "type": "frontend",
              "title": "Launchpad template flow UI (no scan step)",
              "ui_behavior": [
                "Show template version badge line",
                "Show Project Audited only when template audit is VALID"
              ],
              "owners": ["frontend"]
            }
          ],
          "agent_instructions_for_sonnet": {
            "task": "Add Launchpad Contract option flow in Create Presale UI",
            "requirements": [
              "No scan step in Launchpad mode",
              "Show template version and audited status",
              "Block submit only if policy requires audited template and it is missing"
            ]
          }
        },
        {
          "milestone_id": "P3",
          "title": "Presale Solana: parity plan (if you truly want presale on Solana)",
          "priority": "P1",
          "dependencies": ["P0"],
          "deliverables": [
            "Define Solana presale program OR confirm presale is EVM-only and Solana uses fairlaunch/bonding-curve instead",
            "If implemented: program deploy via launchpad, template versioning, and 'Project Audited' inheritance like EVM"
          ],
          "acceptance_criteria": [
            "A clear decision doc exists: 'Presale Solana = YES/NO' with reasons",
            "If YES: Solana create presale UI supports Launchpad template mode (default) and optional external programId review if allowed",
            "Badges are consistent: PROJECT_AUDITED metadata includes program_id and template_version"
          ],
          "work_items": [
            {
              "id": "P3-DECISION-1",
              "type": "product",
              "title": "Decide Solana presale scope",
              "options": [
                "Option A: Presale is EVM-only; Solana uses Fairlaunch/Bonding Curve",
                "Option B: Build Anchor presale program with factory/registry"
              ],
              "owners": ["product", "smartcontract-solana"]
            },
            {
              "id": "P3-SOL-1",
              "type": "smartcontract",
              "title": "If YES: build Anchor presale program + factory metadata",
              "owners": ["smartcontract-solana"]
            },
            {
              "id": "P3-UI-1",
              "type": "frontend",
              "title": "Update Create Presale UI to support Solana branch",
              "owners": ["frontend"]
            }
          ]
        },
        {
          "milestone_id": "P4",
          "title": "Admin: Audit Proof (Security Audited) + Overrides",
          "priority": "P0",
          "dependencies": ["P0"],
          "deliverables": [
            "Audit proof submission flow (developer side)",
            "Admin verify/reject flow",
            "SECURITY_AUDITED badge issuance with metadata",
            "Override scanning outcomes with two-man rule (optional but recommended)"
          ],
          "acceptance_criteria": [
            "Developer can submit audit proof and see status updates",
            "Admin can verify and issue SECURITY_AUDITED",
            "All actions logged in admin_audit_logs",
            "Two-man rule enabled for override/issue if configured"
          ],
          "work_items": [
            {
              "id": "P4-DEV-UI-1",
              "type": "frontend",
              "title": "Developer audit proof submission UI",
              "owners": ["frontend"]
            },
            {
              "id": "P4-ADMIN-UI-1",
              "type": "admin",
              "title": "Admin verify/reject audit proof UI + badge issuance",
              "owners": ["admin-ui"]
            },
            {
              "id": "P4-POLICY-1",
              "type": "backend",
              "title": "Configurable enforcement: SECURITY_AUDITED required by tier",
              "owners": ["backend", "product"]
            }
          ]
        }
      ]
    },
    {
      "track_id": "fairlaunch",
      "title": "Fairlaunch Roadmap (template-only) + Project Audited inheritance",
      "milestones": [
        {
          "milestone_id": "F0",
          "title": "Template registry + audited version mapping",
          "priority": "P0",
          "dependencies": ["presale:P0"],
          "deliverables": [
            "Fairlaunch factory emits template version/hash",
            "Backend template audit registry supports fairlaunch templates",
            "UI shows Project Audited when template audit record exists (STRICT)"
          ],
          "acceptance_criteria": [
            "Fairlaunch created from factory persists template_version/hash",
            "Badge PROJECT_AUDITED issued only when template audit record VALID"
          ],
          "work_items": [
            {
              "id": "F0-SC-1",
              "type": "smartcontract",
              "title": "FairlaunchFactory event includes template version/hash",
              "owners": ["smartcontract-evm", "smartcontract-solana"]
            },
            {
              "id": "F0-BE-1",
              "type": "backend",
              "title": "Template audit registry extended to fairlaunch",
              "owners": ["backend"]
            },
            {
              "id": "F0-UI-1",
              "type": "frontend",
              "title": "Fairlaunch create UI shows audited template status",
              "owners": ["frontend"]
            }
          ]
        }
      ]
    },
    {
      "track_id": "bonding_curve",
      "title": "Bonding Curve Roadmap (Solana) + Project Audited inheritance",
      "milestones": [
        {
          "milestone_id": "B0",
          "title": "Bonding Curve program versioning + audited mapping",
          "priority": "P0",
          "dependencies": ["presale:P0"],
          "deliverables": [
            "Bonding curve deploy/migration emits program version/hash",
            "Backend stores program version and links to template audit proof",
            "UI shows Project Audited only for audited program versions (STRICT)"
          ],
          "acceptance_criteria": [
            "All bonding curve pools record (program_id, version, hash)",
            "PROJECT_AUDITED is attached only when template audit record exists"
          ],
          "work_items": [
            {
              "id": "B0-SOL-1",
              "type": "smartcontract",
              "title": "Anchor program emits version metadata on deploy/migrate",
              "owners": ["smartcontract-solana"]
            },
            {
              "id": "B0-BE-1",
              "type": "backend",
              "title": "Template audit registry extended to bonding curve programs",
              "owners": ["backend"]
            },
            {
              "id": "B0-UI-1",
              "type": "frontend",
              "title": "Bonding curve UI shows audited program status",
              "owners": ["frontend"]
            }
          ]
        }
      ]
    }
  ],
  "implementation_notes_for_agents": {
    "sonnet_ui_tasks": [
      {
        "task_id": "AG-UI-PRESALE-01",
        "title": "Create Presale UI - add contract mode + scan step",
        "must_have": [
          "Contract Mode selector",
          "External: input address + run scan + show status/result",
          "Launchpad: show template info + audited status",
          "Submit blocked server-side + mirrored in UI"
        ],
        "nice_to_have": [
          "Risk flags accordion in FAIL/NEEDS_REVIEW",
          "Retry scan button with cooldown"
        ]
      },
      {
        "task_id": "AG-UI-PRESALE-02",
        "title": "Developer Audit Proof submission UI (optional in create presale)",
        "must_have": [
          "Form: auditor_name, report_url, report_hash(optional), audit_date, scope",
          "Show status: PENDING/VERIFIED/REJECTED"
        ]
      }
    ],
    "admin_tasks": [
      {
        "task_id": "AG-ADMIN-01",
        "title": "Admin scan review + override",
        "must_have": [
          "Queue of NEEDS_REVIEW scans",
          "Override PASS/FAIL requires reason",
          "Audit log entry created"
        ]
      },
      {
        "task_id": "AG-ADMIN-02",
        "title": "Admin audit proof verify + issue SECURITY_AUDITED",
        "must_have": ["Verify/reject proof", "Issue badge with metadata", "Audit log entry created"]
      }
    ]
  }
}
