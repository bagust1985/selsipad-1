{
  "module": "bonding_curve",
  "networks": ["Solana"],
  "doc_type": "docs/ui-ux",
  "recommended_file_path": "docs/ui-ux/bondingcurve_ui-ux.json",
  "version": "1.0",
  "strategy": {
    "current_focus": "UI/UX dulu untuk Bonding Curve (chart candle + swap UI + pool lifecycle UI). Admin UI belakangan.",
    "principles": [
      "Permissionless create (Dev KYC OFF) tapi tetap enforce rule: Team vesting mandatory + LP lock >= 12 months after migration.",
      "Swap UX harus cepat: quote -> slippage -> confirm -> tx timeline.",
      "Chart candle dibuat dari event swaps (indexer/DB) + fallback ke OHLC computed client-side dari trades bila perlu.",
      "Semua tx pakai TxRecord + polling DB/Indexer (refresh-safe)."
    ]
  },
  "product_rules_summary": {
    "bonding_curve_core": {
      "pricing_model": "constant-product with virtual reserves",
      "permissionless": true,
      "dev_kyc_required": false,
      "team_vesting_required": true,
      "fees": {
        "deploy_fee_sol": 0.5,
        "swap_fee_percent": 1.5,
        "swap_fee_split": {
          "treasury_percent_of_fee": 50,
          "referral_pool_percent_of_fee": 50
        },
        "migration_fee_sol": 2.5
      },
      "graduation": {
        "trigger": "target SOL raised reached (configurable)",
        "action": "migrate liquidity to DEX (Raydium/Orca) + create LP lock plan >= 12 months"
      },
      "lp_lock_min_months_after_migration": 12
    }
  },
  "actors": [
    {
      "name": "Guest",
      "can": ["View pool list", "View pool detail", "View chart and trades"],
      "cannot": ["Create pool", "Swap"]
    },
    {
      "name": "User/Trader",
      "can": ["Connect Solana wallet", "Swap BUY/SELL", "View tx history"],
      "cannot": ["Migrate pool (unless owner-driven)"]
    },
    {
      "name": "Pool Creator/Owner",
      "can": [
        "Create pool",
        "Pay deploy fee",
        "Configure migration target",
        "Initiate migrate (if owner-driven)"
      ],
      "gates": ["Team vesting configured", "Deploy fee paid"]
    },
    {
      "name": "Admin (Later)",
      "status": "DEFERRED"
    }
  ],
  "state_machine": {
    "states": [
      "DRAFT",
      "DEPLOYING",
      "LIVE",
      "PAUSED",
      "GRADUATED_PENDING_MIGRATION",
      "MIGRATING",
      "MIGRATED",
      "CLOSED"
    ],
    "key_transitions": [
      { "from": "DRAFT", "to": "DEPLOYING", "trigger": "create_pool + pay_deploy_fee" },
      { "from": "DEPLOYING", "to": "LIVE", "trigger": "onchain_confirmed + indexer_synced" },
      { "from": "LIVE", "to": "GRADUATED_PENDING_MIGRATION", "trigger": "target_raised_reached" },
      { "from": "GRADUATED_PENDING_MIGRATION", "to": "MIGRATING", "trigger": "migrate_called" },
      { "from": "MIGRATING", "to": "MIGRATED", "trigger": "dex_lp_created + lp_lock_created" }
    ]
  },
  "information_architecture": {
    "routes_user": ["/bonding-curve", "/bonding-curve/:id", "/bonding-curve/:id/transactions"],
    "routes_creator": ["/create/bonding-curve", "/dashboard/owner/bonding-curve"],
    "navigation_entry_points": [
      "Explore -> Bonding Curve pools",
      "Project detail -> Create Bonding Curve (owner)",
      "Profile -> My pools (owner)"
    ]
  },
  "screens_uiux": [
    {
      "id": "SCR-BC-01",
      "name": "Bonding Curve Pools List",
      "sections": [
        "Filters: status (LIVE/GRADUATED/MIGRATED), search, sort (volume, newest, marketcap)",
        "Cards: token, status pill, price, 24h volume, progress to graduation, sparkline mini-chart",
        "CTA: View pool"
      ],
      "states": ["loading", "empty", "error"]
    },
    {
      "id": "SCR-BC-02",
      "name": "Bonding Curve Pool Detail",
      "layout": "2-column (left chart+info, right swap)",
      "tabs": ["Overview", "Chart", "Swap", "Trades", "Transactions"],
      "overview_sections": [
        "Header: token, mint, status",
        "KPIs: price, marketcap (est.), liquidity/reserves, 24h volume, holders (optional)",
        "Progress: graduation bar (SOL raised / target)",
        "Fees: 1.5% + split info",
        "Migration: target, migration fee 2.5 SOL, LP lock requirement >= 12 months"
      ],
      "chart_sections": [
        "Candle chart timeframe selector: 1m/5m/15m/1h/4h/1d",
        "Overlay: volume bars (optional)",
        "Latest price + change%",
        "Fallback if no candles: show line chart from last trades"
      ],
      "swap_sections": [
        "Mode toggle: BUY / SELL",
        "Token in/out selectors (fixed: SOL <-> TOKEN)",
        "Amount input + max",
        "Quote panel: expected output, price impact, fee, minimum received (slippage)",
        "Slippage settings: preset + custom",
        "CTA: Swap",
        "TxStatusTimeline (CREATED->SUBMITTED->CONFIRMED/FAILED)",
        "Error handling: insufficient SOL, blockhash expired, user reject"
      ],
      "trades_sections": [
        "Recent trades table: time, side, price, amount, tx link",
        "Pagination or infinite scroll"
      ],
      "transactions_sections": [
        "Tx list from DB: create_pool, swap, migrate, lock_lp",
        "Explorer links"
      ],
      "states": ["loading", "empty", "error", "indexer_delay_notice"]
    },
    {
      "id": "SCR-BC-03",
      "name": "Create Bonding Curve Wizard (Owner)",
      "steps": [
        "Basic Info (token mint, name, symbol, image)",
        "Curve Params (virtual reserves, initial price hints, graduation target SOL)",
        "Fees Summary (deploy fee 0.5 SOL, swap fee 1.5%, migration fee 2.5 SOL)",
        "Team Vesting (mandatory)",
        "Review & Create (pay deploy fee + sign tx)"
      ],
      "validation": [
        "Team vesting required",
        "Deploy fee must be acknowledged",
        "Graduation target must be > 0"
      ],
      "states": ["draft_saved", "deploying", "live"]
    },
    {
      "id": "SCR-BC-04",
      "name": "Owner Pools Dashboard",
      "sections": [
        "List pools created",
        "Actions: View, Pause (if allowed), Initiate Migration (when graduated), View analytics (later)"
      ],
      "states": ["loading", "empty", "error"]
    }
  ],
  "chart_spec": {
    "chart_type": "candlestick",
    "data_sources_priority": [
      "Indexer-provided OHLCV candles table (preferred)",
      "Compute OHLCV from trades/swaps events if candles not stored"
    ],
    "timeframes": [
      { "label": "1m", "bucket_seconds": 60 },
      { "label": "5m", "bucket_seconds": 300 },
      { "label": "15m", "bucket_seconds": 900 },
      { "label": "1h", "bucket_seconds": 3600 },
      { "label": "4h", "bucket_seconds": 14400 },
      { "label": "1d", "bucket_seconds": 86400 }
    ],
    "ohlcv_fields": ["timestamp_bucket", "open", "high", "low", "close", "volume"],
    "ui_requirements": [
      "Timeframe selector",
      "Hover tooltip (OHLC + volume + time)",
      "Empty state when no trades",
      "Auto-refresh option (toggle) every 5-15s for active pools"
    ]
  },
  "swap_spec": {
    "assets": {
      "base": "SOL",
      "quote": "TOKEN"
    },
    "quote_fields": [
      "expected_out",
      "min_received",
      "price_impact_percent",
      "fee_amount",
      "fee_percent",
      "route_note (bonding curve pool)"
    ],
    "slippage": {
      "presets_percent": [0.5, 1, 2, 5],
      "custom_allowed": true,
      "default_percent": 1
    },
    "tx_actions": ["swap_buy", "swap_sell"],
    "failure_modes": [
      "insufficient_balance",
      "user_rejected",
      "blockhash_expired",
      "rpc_timeout",
      "pool_paused",
      "slippage_too_low"
    ],
    "anti_double_submit": "Disable CTA while tx pending + idempotent intent on server"
  },
  "data_contract_ui": {
    "entities": {
      "BondingCurvePool": {
        "fields": [
          "id",
          "projectId(optional)",
          "network",
          "cluster",
          "status",
          "tokenMint",
          "poolProgramId",
          "poolAddress",
          "virtualReserves",
          "realReserves",
          "price",
          "marketcapEstimate",
          "volume24h",
          "graduationTargetSol",
          "raisedSol",
          "deployFeePaid",
          "teamVestingPlanId",
          "lpLockPlanId(afterMigration)",
          "createdAt",
          "updatedAt"
        ]
      },
      "Trade": {
        "fields": [
          "id",
          "poolId",
          "timestamp",
          "side",
          "price",
          "amountIn",
          "amountOut",
          "feeAmount",
          "txSig",
          "walletAddress(optional)"
        ]
      },
      "Candle": {
        "fields": [
          "poolId",
          "timeframe",
          "timestamp_bucket",
          "open",
          "high",
          "low",
          "close",
          "volume"
        ]
      },
      "TxRecord": {
        "fields": [
          "id",
          "action",
          "network",
          "hashOrSig",
          "status",
          "metadata",
          "createdAt",
          "updatedAt"
        ]
      }
    },
    "api_endpoints_planned": [
      { "method": "GET", "path": "/api/bonding-curve", "desc": "List pools" },
      { "method": "GET", "path": "/api/bonding-curve/:id", "desc": "Pool detail" },
      { "method": "POST", "path": "/api/bonding-curve", "desc": "Create draft/init pool (owner)" },
      {
        "method": "POST",
        "path": "/api/bonding-curve/:id/deploy",
        "desc": "Pay deploy fee + deploy/init (Solana tx)"
      },
      { "method": "GET", "path": "/api/bonding-curve/:id/candles?tf=1m", "desc": "OHLCV candles" },
      { "method": "GET", "path": "/api/bonding-curve/:id/trades", "desc": "Recent trades" },
      { "method": "POST", "path": "/api/bonding-curve/:id/swap/quote", "desc": "Get quote" },
      {
        "method": "POST",
        "path": "/api/bonding-curve/:id/swap/intent",
        "desc": "Create swap intent (ix payload + tx record)"
      },
      {
        "method": "POST",
        "path": "/api/bonding-curve/:id/swap/confirm",
        "desc": "Confirm swap (update DB)"
      },
      {
        "method": "POST",
        "path": "/api/bonding-curve/:id/migrate",
        "desc": "Migrate to DEX when graduated"
      }
    ]
  },
  "roadmap": {
    "milestones": [
      {
        "id": "BC-M1",
        "name": "UI/UX Spec + IA",
        "goal": "Dokumen UI/UX Bonding Curve lengkap (list, detail, create wizard, owner dashboard) termasuk candle chart + swap panel",
        "outputs": [
          "routes + screens definition",
          "component spec (chart, swap, trades)",
          "state machine mapping"
        ],
        "definition_of_done": [
          "Candle chart spec jelas (timeframes, fields, empty state)",
          "Swap UX spec jelas (quote, slippage, errors)"
        ]
      },
      {
        "id": "BC-M2",
        "name": "User UI: Pools List + Detail Skeleton",
        "goal": "User bisa browse pools & lihat detail (overview + placeholder chart/swap)",
        "outputs": ["/bonding-curve", "/bonding-curve/:id"],
        "definition_of_done": [
          "Render by status",
          "Explorer links",
          "No crash on wallet disconnected"
        ]
      },
      {
        "id": "BC-M3",
        "name": "Candle Chart Implementation",
        "goal": "Candle chart jalan dengan timeframe selector + tooltip",
        "outputs": [
          "Candlestick component (recharts/custom or lightweight lib)",
          "Data fetching candles + fallback compute from trades"
        ],
        "definition_of_done": [
          "Timeframe switching works",
          "Empty state handled",
          "Auto-refresh toggle works"
        ]
      },
      {
        "id": "BC-M4",
        "name": "Swap UI Implementation (Quote -> Intent -> TxTimeline)",
        "goal": "Swap panel lengkap: quote, slippage, confirm tx timeline",
        "outputs": [
          "SwapPanel component",
          "Quote hook + debounce",
          "TxStatusTimeline integrated (mock ok)"
        ],
        "definition_of_done": [
          "BUY/SELL works at UI level",
          "Error states & anti double-submit implemented",
          "Tx states render correctly"
        ]
      },
      {
        "id": "BC-M5",
        "name": "Create Pool Wizard + Owner Dashboard",
        "goal": "Owner bisa create pool + pay deploy fee (UI flow), team vesting mandatory",
        "outputs": ["/create/bonding-curve", "/dashboard/owner/bonding-curve"],
        "definition_of_done": "Wizard validations complete + status DEPLOYING->LIVE displayed"
      },
      {
        "id": "BC-M6",
        "name": "Prep Migration UX (Defer On-chain)",
        "goal": "Tampilkan graduation progress + CTA migrate (disabled until eligible) + LP lock requirement messaging",
        "outputs": [
          "Graduation progress section",
          "Migration CTA + fee disclosure",
          "LP lock requirement banner"
        ],
        "definition_of_done": "No dead-end UX; user understands next step"
      }
    ]
  },
  "execution_prompt": {
    "target_agent": "sonnet",
    "format": "implementation",
    "prompt": "Bangun UI/UX modul Bonding Curve (Solana) sesuai roadmap dan spec ini, dengan fokus utama: (1) Candle chart (OHLCV) dengan timeframe selector + tooltip + empty state + optional auto-refresh, (2) Swap panel BUY/SELL lengkap dengan quote, slippage presets+custom, min received, price impact, fee, dan TxStatusTimeline (TxRecord-based polling; boleh mock adapter jika backend belum lengkap). Implementasikan halaman: /bonding-curve (list+filters), /bonding-curve/:id (overview+chart+swap+trades+transactions), /create/bonding-curve (wizard + deploy fee disclosure), /dashboard/owner/bonding-curve (owner pools). Pastikan UX robust: wallet connect prompt, insufficient balance, user rejected, blockhash expired, rpc timeout, pool paused, slippage too low; anti double-submit; explorer links. Output PR-ready patch + file change list + manual QA checklist.",
    "deliverables": [
      "PR-ready patch (pages + components + hooks)",
      "Manual QA checklist (chart + swap + navigation)",
      "docs/ui-ux/bondingcurve_ui-ux.json updated"
    ],
    "constraints": [
      "Admin UI deferred.",
      "Keep dependencies lightweight (avoid heavy chart libs if possible).",
      "Reuse existing shared components from Presale/Fairlaunch where applicable.",
      "Tx status must be refresh-safe (DB/Indexer polling)."
    ],
    "output_format_required": [
      "1) Summary implementasi",
      "2) File list perubahan",
      "3) Chart data approach (candles vs computed from trades)",
      "4) Swap UX & error handling mapping",
      "5) Manual QA steps"
    ]
  }
}
