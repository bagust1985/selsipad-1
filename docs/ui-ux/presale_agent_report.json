{
  "module": "presale",
  "status": {
    "done": {
      "phase_1_backend_api": {
        "summary": "All 13 endpoints exist",
        "endpoints": [
          "GET /api/rounds",
          "POST /api/rounds",
          "PATCH /api/rounds/[id]",
          "DELETE /api/rounds/[id]",
          "POST /api/rounds/[id]/submit",
          "POST /api/admin/rounds/[id]/approve",
          "POST /api/admin/rounds/[id]/reject",
          "POST /api/rounds/[id]/contribute/intent",
          "POST /api/rounds/[id]/contribute/confirm",
          "GET /api/rounds/[id]/refund/quote",
          "POST /api/rounds/[id]/refund/claim",
          "GET /api/admin/rounds/[id]/vesting/analytics",
          "POST /api/admin/rounds/[id]/deploy"
        ]
      },
      "phase_1_frontend_pages": {
        "pages": ["/presales", "/presales/[id]"],
        "notes": "List page with filters, detail page with tabs"
      },
      "phase_2a_wizard_components": {
        "wizard_steps": 9,
        "validation": "Zod schemas complete",
        "components": ["VestingScheduleBuilder", "ComplianceGateBanner"],
        "notes": "Step components created + validation"
      },
      "phase_2b_main_wizard_and_owner_dashboard": {
        "pages": ["/create/presale", "/dashboard/owner/presales"],
        "features": [
          "Auth guarded",
          "Wizard state management",
          "LocalStorage persistence",
          "Server actions: createDraft, submit, update, delete",
          "Owner dashboard tab filtering + context-aware actions"
        ]
      },
      "backend_compliance_gates": {
        "enforced": true,
        "gates": ["KYC", "SC Scan", "Investor Vesting", "Team Vesting", "LP Lock"]
      }
    },
    "pending": {
      "phase_2c_admin_review_queue": {
        "items": [
          "/admin/presales/review page",
          "Admin approve/reject UI with reason input",
          "Rejection reason display on owner dashboard"
        ]
      },
      "phase_3_onchain_integration": {
        "items": [
          "Deploy presale contract/program (EVM & Solana)",
          "Contribution flow (intent + confirm) with actual tx",
          "Refund flow (quote + claim) with actual tx",
          "Tx manager integration (wagmi + Solana web3)",
          "Tx status tracking + polling"
        ]
      },
      "phase_4_testing": {
        "items": [
          "Endpoint integration tests",
          "Compliance gate tests",
          "Contribution flow tests",
          "E2E tests wizard -> submit -> approve -> deploy"
        ]
      }
    }
  },
  "definition_of_done": {
    "must_have": [
      "Admin review queue fully functional (approve/reject + reason + audit)",
      "On-chain deploy + contribute + refund works on EVM & Solana",
      "Tx status is consistent (Created->Submitted->Confirmed/Failed) and resilient to refresh",
      "Basic test suite exists (API + gates + E2E happy path)"
    ],
    "nice_to_have": [
      "Explorer links everywhere",
      "Admin compliance checklist UI with pass/fail highlights",
      "E2E coverage for refund fail path"
    ]
  },
  "next_steps_execution_order": [
    {
      "priority": 1,
      "phase": "2C",
      "title": "Admin Review Queue",
      "goal": "Unblock presale lifecycle end-to-end (submit->approve/reject)",
      "deliverables": [
        "/admin/presales/review page (queue + detail panel)",
        "Approve + Reject modal (reason required on reject)",
        "Owner dashboard shows rejection reason + 'Resubmit' CTA",
        "Audit log visible/recorded (if already supported backend)"
      ],
      "acceptance_criteria": [
        "Admin can approve and presale moves to APPROVED_TO_DEPLOY",
        "Admin can reject with reason and owner sees reason in dashboard",
        "No unauthorized access (admin route protected)"
      ]
    },
    {
      "priority": 2,
      "phase": "3",
      "title": "On-chain Integration",
      "goal": "Make endpoints actually execute blockchain ops",
      "deliverables": [
        "Deploy flow: owner signs tx, backend stores tx record, UI shows DEPLOYING->LIVE",
        "Contribute flow: intent returns tx payload, client signs/sends, confirm hits backend",
        "Refund flow: quote displayed, claim sends tx, backend confirms + updates DB",
        "Tx manager integration: standardized status updates + polling"
      ],
      "acceptance_criteria": [
        "EVM: deploy + contribute + refund works on a test chain",
        "Solana: init + contribute + refund works on devnet/test validator",
        "Refresh-safe: UI always recovers from DB/tx records"
      ],
      "risk_controls": [
        "Idempotency key per intent to prevent double-submit",
        "Network mismatch detection + switch prompt",
        "Graceful handling of rejected signature + RPC timeout"
      ]
    },
    {
      "priority": 3,
      "phase": "4",
      "title": "Testing",
      "goal": "Prevent regressions and stabilize CI",
      "deliverables": [
        "API integration tests for main endpoints",
        "Gate validation tests (backend)",
        "E2E happy path: wizard create->submit->admin approve->deploy->contribute",
        "Basic on-chain mocks or test env utilities"
      ],
      "acceptance_criteria": [
        "CI runs tests with deterministic results",
        "At least 1 E2E flow passing consistently"
      ]
    }
  ],
  "agent_prompts": {
    "phase_2c_admin_review_queue": {
      "target_agent": "sonnet",
      "format": "implementation",
      "prompt": "Implement Phase 2C Admin Review Queue for Presale. Build /admin/presales/review page with queue list and detail panel. Admin must be able to approve or reject a presale; rejection must require a reason. Wire actions to existing endpoints POST /api/admin/rounds/[id]/approve and POST /api/admin/rounds/[id]/reject. Ensure admin route is protected. Update owner dashboard (/dashboard/owner/presales) to display rejection reason when status=REJECTED and provide a clear CTA to edit + resubmit. Add UI states: loading, empty, error, success toast. Deliver PR-ready patch with files changed, and a short manual QA checklist verifying approve/reject/reason visibility."
    },
    "phase_3_onchain_integration": {
      "target_agent": "sonnet",
      "format": "implementation",
      "prompt": "Implement Phase 3 On-chain Integration for Presale (EVM & Solana) using existing API endpoints. Deploy: wire POST /api/admin/rounds/[id]/deploy to create and track a blockchain deployment tx; update round status DEPLOYING->LIVE after confirmation. Contribute: implement contribute/intent to return tx payload (EVM calldata or Solana instructions) + tx record id; client signs/sends; contribute/confirm updates DB, and indexer/poller finalizes status. Refund: implement refund/quote to show amount and eligibility; refund/claim to execute tx and update DB. Integrate with wagmi for EVM and Solana web3 for Solana, keeping wallet connector imports minimal. Ensure robust UX: wrong network prompt, rejected signature handling, RPC timeout fallback to polling, and anti double-submit (idempotency). Deliver PR-ready patch and a test checklist for EVM+Solana happy path."
    },
    "phase_4_testing": {
      "target_agent": "sonnet",
      "format": "testing",
      "prompt": "Implement Phase 4 Testing for Presale. Add API integration tests covering: create/update/delete round, submit, admin approve/reject, contribute intent/confirm, refund quote/claim, deploy endpoint. Add backend compliance gate tests ensuring KYC/SC Scan/Vesting/LP Lock rules block when invalid. Add at least one E2E happy path test: wizard create->submit->admin approve->deploy->contribute. Ensure tests are deterministic and runnable in CI with clear setup/teardown. Output: list of tests added, how to run locally, and pass/fail results."
    }
  }
}
